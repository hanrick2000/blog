<script>
  //<![CDATA[
  if (!window.location.pathname.endsWith(".html")) {
    var links = document.querySelectorAll("#TOC a")
    links.forEach(function (link) {
      var post = link.closest(".post.hentry.uncustomized-post-template")
      var base = post.querySelector("h3>a").href;
      var parts = link.href.split('#');
      var anchor = parts[parts.length-1];
      link.href= base+'#'+anchor
    });
  }

  window.onload = function () {
    // use left/right key to go to newer/older post
    document.onkeyup = function (e) {
      if (document.activeElement.nodeName == "TEXTAREA" || document.activeElement.nodeName == "INPUT") return;
      e = e || window.event;
      switch (e.keyCode) {
      case 37:
        var t = document.getElementById("Blog1_blog-pager-newer-link");
        if (t != null) window.location.href = t.href;
        break;
      case 39:
        var n = document.getElementById("Blog1_blog-pager-older-link");
        if (n != null) window.location.href = n.href
      }
    }
  }

  var noNeedRelated = document.getElementById("related-posts") || document.title.toLowerCase().startsWith("home page") || document.title.toLowerCase().endsWith("archives") || document.location.pathname == "/p/search-results.html" ;
  if (!noNeedRelated) {
    var labels = document.querySelectorAll(".post-labels a");
    var candidates = new Array();
    for (var i = 0; i < labels.length; i++) {
      var innerText = labels[i].innerText;
      if (innerText == 'From_Github') continue;
      if (innerText.toLowerCase().endsWith("series")) continue;
      candidates.push(innerText);
    }
    var pos = Math.floor(Math.random() * candidates.length);
    var finalLabel = candidates[pos];

    var postBody = document.getElementsByClassName("post hentry")[0];
    var postFooter = document.getElementsByClassName("post-footer")[0];
    var relatedPostsHeader = document.createElement("h4");
    relatedPostsHeader.id = "related-posts";
    relatedPostsHeader.innerHTML = "<br><a href='/search/label/" + finalLabel + "' target='blank'>Related Posts</a>"
    postFooter.before(relatedPostsHeader)

    var related_posts_content = document.createElement("div");
    related_posts_content.id = "related_posts_content";
    postFooter.before(related_posts_content)

    document.write('<script type="text/javascript" src="/feeds/posts/default/-/' + finalLabel + '?orderby=updated&amp;alt=json-in-script&amp;callback=weightedRandomRelatedPostsAddToParent&amp;max-results=20"><\/script>');

    document.write('<script type="text/javascript" src="/feeds/posts/default/-/Trending?orderby=updated&amp;alt=json-in-script&amp;callback=weightedRandomRelatedPostsAddToParent&amp;max-results=20"><\/script>');
  }

  publisedPopulars.clear();
  publisedRelateds.clear();
  publisedTrednings.clear();
  window.addEventListener("load", function () {
    // left side bar
    removeNotLoadedAds(332930, 332931, 332932);
    // right top
    removeNotLoadedAds(333324, 333326);
    // right bottom
    removeNotLoadedAds(333321,615867);
    // inline page head, tail and ads
    removeNotLoadedAds(332933, 332942, 332935);
  });

  if(document.location.href.endsWith(".html")) {
    var tocDetails = document.querySelector("#TOC details");
    if(tocDetails) tocDetails.removeAttribute("open");
  }

  var titleEl = document.querySelector(".post-title");
  if(titleEl && !titleEl.innerHTML.startsWith("<a")) {
    titleEl.innerHTML = "<a href='"+window.location.href+"'>"+titleEl.innerHTML+"</a>";
  }
  //]]>
</script>
<!--
<script type="text/javascript">
served333326=false
</script>
 -->
 <!-- <script src="//ap.lijit.com/www/delivery/fpi.js?z=333326&width=300&height=250"></script> -->